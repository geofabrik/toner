{
  "variables": {
    "aws_access_key": "",
    "aws_secret_key": "",
    "database_url":"postgres:///osm"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "region": "us-east-1",
      "availability_zone":"us-east-1d",
      "source_ami": "ami-26db174e",
      "instance_type": "m3.medium",
      "ssh_username": "ubuntu",
      "ami_name": "toner-rendering {{timestamp}}"
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "labels.mss",
      "destination": "/home/ubuntu/toner-carto/labels.mss"
    },
    {
      "type": "file",
      "source": "map.mss",
      "destination": "/home/ubuntu/toner-carto/map.mss"
    },
    {
      "type": "file",
      "source": "Makefile",
      "destination": "/home/ubuntu/toner-carto/Makefile"
    },
    {
      "type": "file",
      "source": "tessera.json",
      "destination": "/home/ubuntu/toner-carto/tessera.json"
    },
    {
      "type": "file",
      "source": "toner-background.yml",
      "destination": "/home/ubuntu/toner-carto/toner-background.yml"
    },
    {
      "type": "file",
      "source": "toner-base.yml",
      "destination": "/home/ubuntu/toner-carto/toner-base.yml"
    },
    {
      "type": "file",
      "source": "toner-buildings.mss",
      "destination": "/home/ubuntu/toner-carto/toner-buildings.mss"
    },
    {
      "type": "file",
      "source": "toner-buildings.yml",
      "destination": "/home/ubuntu/toner-carto/toner-buildings.yml"
    },
    {
      "type": "file",
      "source": "toner-hybrid.yml",
      "destination": "/home/ubuntu/toner-carto/toner-hybrid.yml"
    },
    {
      "type": "file",
      "source": "toner-labels.mss",
      "destination": "/home/ubuntu/toner-carto/toner-labels.mss"
    },
    {
      "type": "file",
      "source": "toner-labels.yml",
      "destination": "/home/ubuntu/toner-carto/toner-labels.yml"
    },
    {
      "type": "file",
      "source": "toner-lines.mss",
      "destination": "/home/ubuntu/toner-carto/toner-lines.mss"
    },
    {
      "type": "file",
      "source": "toner-lines.yml",
      "destination": "/home/ubuntu/toner-carto/toner-lines.yml"
    },
    {
      "type": "file",
      "source": "toner.yml",
      "destination": "/home/ubuntu/toner-carto/toner.yml"
    },
    {
      "type": "file",
      "source": "images",
      "destination": "/home/ubuntu/toner-carto/images"
    },
    {
      "type": "file",
      "source": "shp/labels_admin",
      "destination": "/home/ubuntu/toner-carto/shp/"
    },
    {
      "type": "file",
      "source": "shp/continents_900913.dbf",
      "destination": "/home/ubuntu/toner-carto/shp/continents_900913.dbf"
    },
    {
      "type": "file",
      "source": "shp/continents_900913.prj",
      "destination": "/home/ubuntu/toner-carto/shp/continents_900913.prj"
    },
    {
      "type": "file",
      "source": "shp/continents_900913.shp",
      "destination": "/home/ubuntu/toner-carto/shp/continents_900913.shp"
    },
    {
      "type": "file",
      "source": "shp/continents_900913.shx",
      "destination": "/home/ubuntu/toner-carto/shp/continents_900913.shx"
    },
    {
      "type": "file",
      "source": "provisioning/tessera.nginx",
      "destination": "/home/ubuntu/toner-carto/tessera.nginx"
    },
    {
      "type": "file",
      "source": "provisioning/tessera.conf",
      "destination": "/home/ubuntu/toner-carto/tessera.conf"
    },
    {
      "type": "shell",
      "inline": "echo DATABASE_URL={{user `database_url`}} > /home/ubuntu/toner-carto/.env"
    },
    {
      "type": "shell",
      "script": "provisioning/install_services.sh"
    }
  ]
}
